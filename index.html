<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Benaiah Secondary Portal</title>

<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>
:root { --chocolate:#3E2723; --gold:#FFB300; }

body{
background:#fcfaf5;
font-family:'Segoe UI',sans-serif;
display:flex;
justify-content:center;
align-items:center;
height:100vh;
margin:0;
}

.login-container{
background:white;
padding:40px;
border-radius:20px;
box-shadow:0 10px 25px rgba(0,0,0,0.1);
width:100%;
max-width:350px;
text-align:center;
}

.logo-placeholder{
background:var(--chocolate);
color:var(--gold);
width:60px;
height:60px;
line-height:60px;
border-radius:50%;
margin:0 auto 15px;
font-weight:bold;
font-size:20px;
}

.input-group{
text-align:left;
margin-bottom:15px;
}

label{
font-size:12px;
font-weight:600;
}

input{
width:100%;
padding:12px;
border:1px solid #ddd;
border-radius:8px;
}

.login-btn{
width:100%;
padding:12px;
background:var(--chocolate);
color:white;
border:none;
border-radius:8px;
font-weight:bold;
cursor:pointer;
}

.login-btn:hover{
opacity:.9;
}
</style>
</head>

<body>

<div class="login-container">

<div class="logo-placeholder">BIS</div>

<h2>Benaiah International School</h2>
<p style="font-size:11px;color:#777;margin-bottom:25px;">
"Courage, Initiative and Success"
</p>

<form id="loginForm">

<div class="input-group">
<label>Email</label>
<input type="email" id="email" required>
</div>

<div class="input-group">
<label>Password</label>
<input type="password" id="password" required>
</div>

<button class="login-btn">Secure Login</button>

</form>

</div>


<script type="module">

/* =========================
   FIREBASE IMPORTS
========================= */

import { initializeApp }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";

import {
getAuth,
signInWithEmailAndPassword,
onAuthStateChanged,
browserLocalPersistence,
setPersistence
}
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

import {
getFirestore,
doc,
getDoc
}
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";


/* =========================
   FIREBASE CONFIG
========================= */

const firebaseConfig = {
apiKey: "AIzaSyBIQog_gsN6U-2JXwpv8CBSMLuP92W6a7Q",
authDomain: "school-management-system-2f7de.firebaseapp.com",
projectId: "school-management-system-2f7de",
storageBucket: "school-management-system-2f7de.appspot.com",
messagingSenderId: "518987437886",
appId: "1:518987437886:web:3d451457c4a6457e007e6f"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);


/* =========================
   PERSIST LOGIN
========================= */

await setPersistence(auth, browserLocalPersistence);


/* =========================
   AUTO LOGIN
========================= */

onAuthStateChanged(auth, async (user)=>{

// if no user â†’ stay on login
if(!user) return;

try{

const userRef = doc(db,"users",user.uid);
const snap = await getDoc(userRef);

if(!snap.exists()){
alert("User profile missing.");
return;
}

routeUser(snap.data());

}catch(err){
console.error(err);
alert("Something went wrong.");
}

});


/* =========================
   LOGIN
========================= */

document.getElementById("loginForm")
.addEventListener("submit", async (e)=>{

e.preventDefault();

const email =
document.getElementById("email").value.trim();

const password =
document.getElementById("password").value.trim();

try{

const cred =
await signInWithEmailAndPassword(auth,email,password);

const ref = doc(db,"users",cred.user.uid);
const snap = await getDoc(ref);

if(!snap.exists()){
alert("Profile not found.");
return;
}

routeUser(snap.data());

}catch(err){

if(err.code === "auth/user-not-found")
alert("No account with this email.");

else if(err.code === "auth/wrong-password")
alert("Incorrect password.");

else if(err.code === "auth/invalid-email")
alert("Invalid email.");

else
alert("Login failed.");

}

});


/* =========================
   ROLE ROUTER
========================= */

function routeUser(userData){

const role = (userData.role || "")
.toLowerCase()
.trim();

switch(role){

case "proprietress":
window.location.replace("proprietress_dash.html");
break;

case "principal":
window.location.replace("principal_dash.html");
break;

case "teacher":
window.location.replace("teacher_dash.html");
break;

case "student":
window.location.replace("student_dash.html");
break;

default:
alert("No dashboard assigned.");
}

}

</script>

</body>
</html>

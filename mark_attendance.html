<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mark Attendance - BIS</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --chocolate: #3E2723;
            --cream: #FFF8E1;
            --gold: #FFB300;
            --white: #ffffff;
            --present: #2e7d32;
            --absent: #c62828;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background-color: #fcfaf5; padding: 20px; padding-bottom: 80px; }

        .header { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; color: var(--chocolate); }
        .back-btn { font-size: 24px; color: var(--chocolate); text-decoration: none; }

        .filter-section {
            background: var(--white); padding: 15px; border-radius: 12px;
            margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        select {
            width: 100%; padding: 12px; border: 1.5px solid #d7ccc8;
            border-radius: 10px; font-size: 15px; outline: none;
        }

        .student-item {
            background: var(--white); padding: 15px; border-radius: 12px;
            margin-bottom: 10px; display: flex; justify-content: space-between;
            align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.03);
        }
        .student-info h4 { font-size: 15px; color: var(--chocolate); }
        .student-info p { font-size: 11px; color: #888; }

        /* Toggle Switch Styling */
        .status-toggle {
            display: flex; background: #eee; border-radius: 20px; padding: 3px; width: 100px;
        }
        .status-btn {
            flex: 1; padding: 5px; border-radius: 18px; border: none;
            font-size: 10px; font-weight: bold; cursor: pointer; transition: 0.3s;
        }
        .status-btn.p.active { background: var(--present); color: white; }
        .status-btn.a.active { background: var(--absent); color: white; }

        .footer-action {
            position: fixed; bottom: 0; left: 0; width: 100%;
            padding: 15px 20px; background: white; box-shadow: 0 -4px 10px rgba(0,0,0,0.05);
        }
        .save-btn {
            width: 100%; padding: 15px; background: var(--chocolate);
            color: white; border: none; border-radius: 10px; font-weight: bold;
        }
    </style>
</head>
<body>

    <div class="header">
        <a href="teacher_dash.html" class="back-btn"><i class="fas fa-arrow-left"></i></a>
        <h2>Attendance</h2>
    </div>

    <div class="filter-section">
        <label style="font-size: 12px; color: #888; display: block; margin-bottom: 5px;">Select Class</label>
        <select id="classSelector" onchange="loadStudents()">
            <option value="">-- Choose Class --</option>
            <option value="JSS 1">JSS 1</option>
            <option value="JSS 2">JSS 2</option>
            <option value="JSS 3">JSS 3</option>
            <option value="SSS 1">SSS 1</option>
            <option value="SSS 2">SSS 2</option>
            <option value="SSS 3">SSS 3</option>
        </select>
    </div>

    <div id="studentList">
        <p style="text-align: center; color: #999; margin-top: 50px;">Please select a class to view students</p>
    </div>

    <div class="footer-action">
        <button class="save-btn" onclick="saveAttendance()">Submit Attendance</button>
    </div>

    <script>
        let currentAttendance = {};

        function loadStudents() {
            const className = document.getElementById('classSelector').value;
            const container = document.getElementById('studentList');
            const students = JSON.parse(localStorage.getItem('bis_students')) || [];
            
            const filtered = students.filter(s => s.class === className);

            if (filtered.length === 0) {
                container.innerHTML = `<p style="text-align: center; color: #999; margin-top: 50px;">No students found in ${className}</p>`;
                return;
            }

            container.innerHTML = filtered.map(s => {
                // Default to Present (P)
                currentAttendance[s.username] = "P";
                
                return `
                <div class="student-item">
                    <div class="student-info">
                        <h4>${s.fullName}</h4>
                        <p>${s.username}</p>
                    </div>
                    <div class="status-toggle">
                        <button class="status-btn p active" id="p-${s.username}" onclick="toggleStatus('${s.username}', 'P')">P</button>
                        <button class="status-btn a" id="a-${s.username}" onclick="toggleStatus('${s.username}', 'A')">A</button>
                    </div>
                </div>
                `;
            }).join('');
        }

        function toggleStatus(id, status) {
            currentAttendance[id] = status;
            
            const pBtn = document.getElementById(`p-${id}`);
            const aBtn = document.getElementById(`a-${id}`);

            if (status === 'P') {
                pBtn.classList.add('active');
                aBtn.classList.remove('active');
            } else {
                aBtn.classList.add('active');
                pBtn.classList.remove('active');
            }
        }

        function saveAttendance() {
            const className = document.getElementById('classSelector').value;
            if (!className) return alert("Select a class first!");

            const today = new Date().toISOString().split('T')[0];
            const attendanceRecord = {
                date: today,
                class: className,
                records: currentAttendance,
                markedBy: JSON.parse(localStorage.getItem('currentUser')).fullName
            };

            let allRecords = JSON.parse(localStorage.getItem('bis_attendance')) || [];
            allRecords.push(attendanceRecord);
            localStorage.setItem('bis_attendance', JSON.stringify(allRecords));

            alert("Attendance submitted successfully!");
            window.location.href = 'teacher_dash.html';
        }
    </script>
</body>
</html>

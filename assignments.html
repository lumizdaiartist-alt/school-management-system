<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Assignments</title>

<style>
body{
    font-family: Segoe UI;
    background:#fcfaf5;
    padding:20px;
}

h2{ margin-bottom:15px; }

.card{
    background:white;
    padding:18px;
    border-radius:14px;
    margin-bottom:12px;
    box-shadow:0 4px 10px rgba(0,0,0,.06);
    cursor:pointer;
}

.card:hover{
    transform:scale(1.01);
}

.title{
    font-weight:bold;
    font-size:18px;
}

.meta{
    font-size:13px;
    color:gray;
    margin-top:6px;
}

.empty{
    text-align:center;
    margin-top:80px;
    color:gray;
    font-size:18px;
}

/* MODAL */
.modal{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.6);
    display:none;
    align-items:center;
    justify-content:center;
    z-index:999;
}

.modal-content{
    background:white;
    width:100%;
    max-width:400px;
    border-radius:16px;
    padding:22px;
}

.modal h3{
    margin-bottom:10px;
}

.btn{
    width:100%;
    padding:12px;
    border:none;
    border-radius:10px;
    font-weight:bold;
    cursor:pointer;
    margin-top:10px;
}

.done-btn{
    background:#3E2723;
    color:#FFB300;
}

.close-btn{
    background:#eee;
}
</style>
</head>

<body>

<h2>My Assignments</h2>
<div id="list"></div>

<!-- MODAL -->
<div class="modal" id="modal">
    <div class="modal-content">
        <h3 id="mTitle"></h3>
        <p id="mDesc"></p>

        <div class="meta" id="mMeta"></div>

        <button class="btn done-btn" onclick="markDone()">âœ” Mark as Done</button>
        <button class="btn close-btn" onclick="closeModal()">Close</button>
    </div>
</div>

<script>
// AUTH
const user = JSON.parse(localStorage.getItem("currentUser"));
if(!user){
    alert("Session expired");
    location.href="index.html";
}

// NORMALIZE CLASS
const studentClass = (user.class || user.grade || "")
.replace(/\s/g,'')
.toUpperCase();

// STORAGE KEYS
const ASSIGN_KEY = "bis_assignments";
const DONE_KEY = "bis_done_assignments_" + user.username;

// DATA
const allAssignments = JSON.parse(localStorage.getItem(ASSIGN_KEY)) || [];
const doneIDs = JSON.parse(localStorage.getItem(DONE_KEY)) || [];

let activeAssignment = null;

// FILTER
const myAssignments = allAssignments.filter(a=>{
    if(!a.grade) return false;
    const g = a.grade.replace(/\s/g,'').toUpperCase();
    return g === studentClass && !doneIDs.includes(a.id);
});

render(myAssignments);

// RENDER
function render(data){
const list = document.getElementById("list");

if(data.length === 0){
list.innerHTML = `<div class="empty">No assignments ðŸŽ‰</div>`;
return;
}

list.innerHTML = data.reverse().map(a=>`
<div class="card" onclick='openModal(${JSON.stringify(a)})'>
    <div class="title">${a.title}</div>
    <div class="meta">${a.teacher} â€¢ ${a.date}</div>
</div>
`).join("");
}

// MODAL
function openModal(a){
activeAssignment = a;

document.getElementById("mTitle").innerText = a.title;
document.getElementById("mDesc").innerText = a.description;
document.getElementById("mMeta").innerHTML = `
Teacher: ${a.teacher}<br>
Class: ${a.grade}<br>
Date: ${a.date}
`;

document.getElementById("modal").style.display="flex";
}

function closeModal(){
document.getElementById("modal").style.display="none";
activeAssignment=null;
}

// DONE
function markDone(){
if(!activeAssignment) return;

doneIDs.push(activeAssignment.id);
localStorage.setItem(DONE_KEY, JSON.stringify(doneIDs));

closeModal();
location.reload();
}
</script>

</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BIS Admin - Proprietress</title>

<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>
:root {
--chocolate:#3E2723;
--cream:#FFF8E1;
--gold:#FFB300;
--white:#ffffff;
}

*{
margin:0;
padding:0;
box-sizing:border-box;
font-family:'Segoe UI',sans-serif;
}

body{
background:#fcfaf5;
}

/* NAV */
.navbar{
background:var(--chocolate);
padding:15px 20px;
display:flex;
justify-content:space-between;
align-items:center;
color:var(--cream);
}

.menu-btn{font-size:24px;cursor:pointer;}
.school-name{font-weight:bold;}
.settings-btn{color:var(--gold);cursor:pointer;}

/* SIDE MENU */
.side-menu{
position:fixed;
top:0;
left:-280px;
width:280px;
height:100%;
background:var(--chocolate);
color:white;
transition:.3s;
padding:40px 20px;
z-index:2000;
}

.side-menu.active{left:0;}

.menu-link{
display:flex;
gap:12px;
padding:14px;
color:var(--cream);
text-decoration:none;
border-radius:8px;
}

.logout-link{
color:#ff8a80;
cursor:pointer;
}

/* CONTENT */
.content{
padding:20px;
}

.welcome-card{
background:white;
padding:25px;
border-radius:15px;
border-left:8px solid var(--chocolate);
margin-bottom:20px;
}

.stats-grid{
display:grid;
grid-template-columns:1fr 1fr;
gap:15px;
}

.stat-box{
background:white;
padding:20px;
border-radius:15px;
text-align:center;
}

.term-box{
grid-column:span 2;
background:white;
padding:20px;
border-radius:15px;
text-align:center;
}
</style>
</head>

<body>

<div class="navbar">
<i class="fas fa-bars menu-btn" onclick="toggleMenu()"></i>
<div class="school-name">BIS Portal</div>
<i id="logoutBtn" class="fas fa-sign-out-alt settings-btn" title="Logout"></i>
</div>

<div class="side-menu" id="sideMenu">
<h3 id="sideMenuName">Loading...</h3>
<p style="font-size:12px;">Proprietress</p>

<a href="#" class="menu-link">Home</a>
<a href="add_principal.html" class="menu-link">Add Principal</a>
<a href="add_teacher.html" class="menu-link">Add Teacher/Admin</a>
<a href="staff_list.html" class="menu-link">Staff List</a>

<a class="menu-link logout-link" id="logoutBtn2">
<i class="fas fa-sign-out-alt"></i> Logout
</a>
</div>

<div class="content">

<div class="welcome-card">
<h2 id="welcomeName">Welcome...</h2>
<p>"Courage, Initiative and Success"</p>
</div>

<div class="stats-grid">

<div class="stat-box">
<h4 id="studentCount">--</h4>
<p>Students</p>
</div>

<div class="stat-box">
<h4 id="teacherCount">--</h4>
<p>Teachers</p>
</div>

<div class="term-box">
<h4>School Dashboard Active</h4>
<p>Authorized Proprietress</p>
</div>

</div>
</div>



<!-- ðŸ”¥ FIREBASE SCRIPT -->
<script type="module">

/* ========================
   IMPORTS
======================== */

import { initializeApp }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";

import {
getAuth,
onAuthStateChanged,
signOut
}
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

import {
getFirestore,
doc,
getDoc,
collection,
getDocs
}
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";


/* ========================
   CONFIG
======================== */

const firebaseConfig = {
apiKey: "AIzaSyBIQog_gsN6U-2JXwpv8CBSMLuP92W6a7Q",
authDomain: "school-management-system-2f7de.firebaseapp.com",
projectId: "school-management-system-2f7de",
storageBucket: "school-management-system-2f7de.appspot.com",
messagingSenderId: "518987437886",
appId: "1:518987437886:web:3d451457c4a6457e007e6f"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);



/* ========================
   ðŸ”¥ PROTECT DASHBOARD
======================== */

onAuthStateChanged(auth, async (user)=>{

if(!user){
window.location.replace("index.html");
return;
}

/* GET USER PROFILE */

const ref = doc(db,"users",user.uid);
const snap = await getDoc(ref);

if(!snap.exists()){
alert("Profile missing.");
await signOut(auth);
window.location.replace("index.html");
return;
}

const data = snap.data();

/* ðŸ”¥ ROLE PROTECTION */
if((data.role || "").toLowerCase() !== "proprietress"){
alert("Unauthorized access.");
await signOut(auth);
window.location.replace("index.html");
return;
}

/* LOAD NAME */
document.getElementById("welcomeName")
.innerText = "Welcome " + (data.fullName || "Proprietress");

document.getElementById("sideMenuName")
.innerText = data.fullName || "Proprietress";


/* OPTIONAL â€” LOAD COUNTS */

loadStats();

});



/* ========================
   LOAD STATS
======================== */

async function loadStats(){

const users = await getDocs(collection(db,"users"));

let students=0, teachers=0, admins=0;

users.forEach(doc=>{

const role = (doc.data().role || "").toLowerCase();

if(role==="student") students++;
else if(role==="teacher") teachers++;
else if(role==="principal") admins++;

});

document.getElementById("studentCount").innerText = students;
document.getElementById("teacherCount").innerText = teachers;

}



/* ========================
   LOGOUT
======================== */

async function logout(){

await signOut(auth);

window.location.replace("index.html");

}

document.getElementById("logoutBtn").onclick = logout;
document.getElementById("logoutBtn2").onclick = logout;



/* ========================
   UI
======================== */

window.toggleMenu = function(){
document.getElementById("sideMenu")
.classList.toggle("active");
};

</script>

</body>
</html>

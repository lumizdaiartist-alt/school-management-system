<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Class Directory - BIS</title>

<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>
:root {
--chocolate: #3E2723;
--cream: #FFF8E1;
--gold: #FFB300;
--white: #ffffff;
--text-muted: #8D6E63;
}

* { margin:0; padding:0; box-sizing:border-box; font-family:'Inter','Segoe UI',sans-serif; }

body{
background-color:#fcfaf5;
padding-bottom:30px;
color:var(--chocolate);
}

.top-bar{
background:var(--chocolate);
padding:30px 20px;
color:white;
border-radius:0 0 25px 25px;
margin-bottom:10px;
}

.header-content{
display:flex;
align-items:center;
gap:15px;
}

.back-btn{
color:white;
font-size:20px;
text-decoration:none;
}

/* SEARCH */
.search-container{
padding:0 20px;
margin-bottom:20px;
}

.search-box{
display:flex;
background:white;
padding:12px 15px;
border-radius:12px;
border:1px solid #efebe9;
align-items:center;
gap:10px;
}

.search-box input{
border:none;
outline:none;
width:100%;
font-size:14px;
}

/* GRID */
.class-grid{
display:grid;
grid-template-columns:repeat(4,1fr);
gap:8px;
padding:0 20px;
margin-bottom:20px;
}

.class-card{
background:white;
padding:10px 5px;
border-radius:10px;
text-align:center;
border:1px solid #efebe9;
cursor:pointer;
font-size:10px;
font-weight:600;
color:var(--text-muted);
transition:.2s;
}

.class-card.active{
background:var(--gold);
border-color:var(--gold);
color:var(--chocolate);
}

.section-title{
padding:0 20px;
margin-bottom:15px;
font-size:13px;
display:flex;
justify-content:space-between;
}

#studentCount{
font-weight:bold;
color:var(--gold);
background:var(--chocolate);
padding:2px 8px;
border-radius:10px;
}

.student-list{
padding:0 20px;
}

.teacher-student-row{
background:white;
padding:12px;
border-radius:15px;
margin-bottom:10px;
display:flex;
align-items:center;
gap:12px;
}

.avatar{
width:45px;
height:45px;
border-radius:10px;
background:var(--cream);
display:flex;
align-items:center;
justify-content:center;
font-weight:bold;
font-size:18px;
flex-shrink:0;
overflow:hidden;
}

.avatar img{
width:100%;
height:100%;
object-fit:cover;
}

.name-box{
flex-grow:1;
}

.name-box h4{
font-size:14px;
margin-bottom:2px;
text-transform:capitalize;
}

.name-box p{
font-size:10px;
color:#a1887f;
}

.class-tag{
font-size:9px;
font-weight:800;
color:var(--gold);
background:var(--chocolate);
padding:2px 6px;
border-radius:4px;
display:inline-block;
margin-bottom:4px;
}

.gender-tag{
font-size:10px;
color:#777;
display:block;
}
</style>
</head>

<body>

<div class="top-bar">
<div class="header-content">
<a href="teacher_dash.html" class="back-btn">
<i class="fas fa-chevron-left"></i>
</a>

<div>
<h2 style="font-size:18px;">Student Directory</h2>
<p style="font-size:11px;opacity:.8;">Benaiah Int'l School</p>
</div>
</div>
</div>

<div class="search-container">
<div class="search-box">
<i class="fas fa-search" style="color:#ccc;"></i>
<input type="text"
id="studentSearch"
placeholder="Search by name or ID..."
onkeyup="handleSearch()">
</div>
</div>

<div class="class-grid">
<div id="btn-All" class="class-card active" onclick="filterByClass('All')">All</div>
<div class="class-card" onclick="filterByClass('JSS1')">JSS 1</div>
<div class="class-card" onclick="filterByClass('JSS2')">JSS 2</div>
<div class="class-card" onclick="filterByClass('JSS3')">JSS 3</div>
<div class="class-card" onclick="filterByClass('SSS1')">SSS 1</div>
<div class="class-card" onclick="filterByClass('SSS2')">SSS 2</div>
<div class="class-card" onclick="filterByClass('SSS3')">SSS 3</div>
</div>

<div class="section-title">
<span id="listHeading">Connecting...</span>
<span id="studentCount">0</span>
</div>

<div class="student-list" id="displayArea"></div>

<script type="module">

import { initializeApp }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";

import {
getFirestore,
collection,
onSnapshot
}
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

/* ðŸ”¥ YOUR FIREBASE */
const firebaseConfig = {
apiKey: "AIzaSyBIQog_gsN6U-2JXwpv8CBSMLuP92W6a7Q",
authDomain: "school-management-system-2f7de.firebaseapp.com",
projectId: "school-management-system-2f7de",
storageBucket: "school-management-system-2f7de.firebasestorage.app",
messagingSenderId: "518987437886",
appId: "1:518987437886:web:3d451457c4a6457e007e6f",
measurementId: "G-KW2273D3C2"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let cachedStudents = [];
let currentFilter = "All";

/* âœ… REALTIME DATABASE LISTENER */
onSnapshot(collection(db,"users"), snapshot=>{

cachedStudents = [];

snapshot.forEach(doc=>{
const data = doc.data();

/* IMPORTANT FIX */
if(data.role === "student"){
cachedStudents.push(data);
}
});

renderList();

});


function renderList(searchQuery=""){

const area = document.getElementById("displayArea");
const heading = document.getElementById("listHeading");
const countLabel = document.getElementById("studentCount");

/* FILTER BY CLASS (FIXED FIELD NAME) */
let filtered = currentFilter==="All"
? cachedStudents
: cachedStudents.filter(s=>s.class===currentFilter);


/* SEARCH */
if(searchQuery){

filtered = filtered.filter(s=>
s.fullName?.toLowerCase().includes(searchQuery.toLowerCase()) ||
s.username?.toLowerCase().includes(searchQuery.toLowerCase())
);

}

heading.innerText =
currentFilter==="All"
? "All Students"
: `Class: ${currentFilter}`;

countLabel.innerText = filtered.length;


/* SORT */
filtered.sort((a,b)=>
(a.fullName||"").localeCompare(b.fullName||"")
);


if(filtered.length===0){

area.innerHTML =
`<p style="text-align:center;color:#999;margin-top:40px;">
No students found.
</p>`;

return;
}


area.innerHTML = filtered.map(s=>`

<div class="teacher-student-row">

<div class="avatar">
${s.photo
? `<img src="${s.photo}">`
: (s.fullName ? s.fullName.charAt(0) : "?")}
</div>

<div class="name-box">
<h4>${s.fullName || "Unnamed"}</h4>
<p>${s.username || "ID: N/A"}</p>
</div>

<div>
<span class="class-tag">${s.class || "N/A"}</span>
<span class="gender-tag">${s.gender || "-"}</span>
</div>

</div>

`).join("");

}


/* FILTER BUTTON */
window.filterByClass = function(className){

currentFilter = className;

document.querySelectorAll(".class-card").forEach(c=>{
c.classList.toggle(
"active",
c.innerText===className ||
(className==="All" && c.id==="btn-All")
);
});

renderList(document.getElementById("studentSearch").value);

};


/* SEARCH */
window.handleSearch = function(){

renderList(
document.getElementById("studentSearch").value
);

};

</script>

</body>
</html>
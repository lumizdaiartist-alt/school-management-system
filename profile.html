<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>My Profile - BIS</title>

<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>
:root {
--chocolate: #3E2723;
--cream: #FFF8E1;
--gold: #FFB300;
--white: #ffffff;
--bg: #fcfaf5;
}

*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',sans-serif;}
body{background-color:var(--bg);color:var(--chocolate);}

.header{
background:var(--chocolate);
padding:20px;
color:var(--white);
display:flex;
align-items:center;
gap:15px;
}

.header a{color:white;text-decoration:none;font-size:20px;}

.profile-card{
background:white;
margin:20px;
padding:30px 20px;
border-radius:20px;
text-align:center;
box-shadow:0 4px 15px rgba(0,0,0,0.05);
}

.avatar{
width:80px;
height:80px;
background:var(--cream);
color:var(--gold);
border-radius:50%;
display:flex;
align-items:center;
justify-content:center;
font-size:40px;
margin:0 auto 15px;
border:2px solid var(--gold);
}

.info-list{
margin:20px;
background:white;
border-radius:15px;
overflow:hidden;
box-shadow:0 4px 15px rgba(0,0,0,0.05);
}

.info-item{
padding:15px 20px;
border-bottom:1px solid #eee;
display:flex;
justify-content:space-between;
align-items:center;
}

.info-item:last-child{border-bottom:none;}

.action-btn{
margin:20px;
padding:15px;
background:var(--chocolate);
color:white;
border:none;
border-radius:12px;
width:calc(100% - 40px);
font-weight:bold;
cursor:pointer;
}

.modal{
position:fixed;
top:0;left:0;
width:100%;height:100%;
background:rgba(0,0,0,0.7);
display:none;
justify-content:center;
align-items:center;
padding:20px;
}

.modal-content{
background:white;
width:100%;
max-width:350px;
padding:25px;
border-radius:20px;
}
</style>
</head>

<body>

<div class="header">
<a href="student_dash.html"><i class="fas fa-arrow-left"></i></a>
<h2>My Profile</h2>
</div>

<div class="profile-card">
<div class="avatar">
<i class="fas fa-user-graduate"></i>
</div>

<h3 id="profileName">Loading...</h3>
<p id="profileID" style="color:var(--gold);font-weight:bold;"></p>
</div>

<div class="info-list">
<div class="info-item">
<label>Current Class</label>
<span id="infoClass">---</span>
</div>

<div class="info-item">
<label>Account Role</label>
<span>Student</span>
</div>

<div class="info-item">
<label>School</label>
<span>Benaiah Intl School</span>
</div>
</div>

<button class="action-btn" onclick="toggleModal(true)">
Edit Full Name
</button>

<div class="modal" id="editModal">
<div class="modal-content">

<h3>Update Profile</h3>
<input type="text" id="newNameInput" placeholder="Enter new name">

<button class="action-btn"
style="margin:10px 0;width:100%;"
onclick="updateProfile()">
Save Changes
</button>

<button onclick="toggleModal(false)"
style="width:100%;background:none;border:none;color:#888;">
Cancel
</button>

</div>
</div>


<script type="module">

import { initializeApp } from
"https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";

import {
getFirestore,
doc,
getDoc,
updateDoc
}
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";


/* âœ… YOUR REAL CONFIG */
const firebaseConfig = {
apiKey: "AIzaSyBIQog_gsN6U-2JXwpv8CBSMLuP92W6a7Q",
authDomain: "school-management-system-2f7de.firebaseapp.com",
projectId: "school-management-system-2f7de",
storageBucket: "school-management-system-2f7de.firebasestorage.app",
messagingSenderId: "518987437886",
appId: "1:518987437886:web:3d451457c4a6457e007e6f",
measurementId: "G-KW2273D3C2"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);


/* LOAD USER */
let currentUser =
JSON.parse(localStorage.getItem("currentUser"));

if(!currentUser){
location.href="index.html";
}


/* FIRESTORE REF */
const userRef =
doc(db,"users",currentUser.username);


/* LOAD DATA */
async function loadProfile(){

try{

const snap = await getDoc(userRef);

if(snap.exists()){

const data = snap.data();

document.getElementById("profileName").innerText = data.fullName;
document.getElementById("profileID").innerText = "ID: "+data.username;
document.getElementById("infoClass").innerText = data.class || "---";
document.getElementById("newNameInput").value = data.fullName;

}

}catch(err){

console.error(err);
alert("Failed to load profile");

}

}

loadProfile();


/* MODAL */
window.toggleModal = function(show){
document.getElementById("editModal").style.display =
show ? "flex" : "none";
}


/* UPDATE PROFILE */
window.updateProfile = async function(){

const newName =
document.getElementById("newNameInput").value.trim();

if(!newName){
alert("Name cannot be empty");
return;
}

try{

await updateDoc(userRef,{
fullName:newName
});

/* update session */
currentUser.fullName = newName;

localStorage.setItem(
"currentUser",
JSON.stringify(currentUser)
);

alert("Profile Updated!");

location.reload();

}catch(err){

console.error(err);
alert("Update failed");

}

}

</script>

</body>
</html>
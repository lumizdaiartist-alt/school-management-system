<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Principal Dashboard - BIS</title>

<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>

:root{
--chocolate:#3E2723;
--gold:#FFB300;
}

body{
margin:0;
font-family:'Segoe UI',sans-serif;
background:#fcfaf5;
}

/* NAV */
.navbar{
background:var(--chocolate);
color:white;
padding:18px 25px;
display:flex;
justify-content:space-between;
align-items:center;
}

.logout-btn{
background:#d32f2f;
border:none;
color:white;
padding:10px 16px;
border-radius:8px;
cursor:pointer;
font-weight:bold;
}

/* CONTENT */
.container{
padding:30px;
max-width:900px;
margin:auto;
}

.card{
background:white;
padding:25px;
border-radius:16px;
box-shadow:0 6px 14px rgba(0,0,0,.06);
margin-bottom:20px;
}

h2{
margin:0 0 5px;
}

.stat-grid{
display:grid;
grid-template-columns:1fr 1fr;
gap:20px;
}

.stat{
font-size:28px;
font-weight:bold;
color:var(--chocolate);
}

.label{
color:gray;
}

</style>
</head>

<body>

<div class="navbar">
<h2>BIS Principal Portal</h2>

<button class="logout-btn" onclick="logout()">
Logout
</button>
</div>


<div class="container">

<div class="card">
<h2 id="principalName">Loading...</h2>
<p id="principalEmail"></p>
</div>

<div class="stat-grid">

<div class="card">
<div class="stat" id="studentCount">0</div>
<div class="label">Students</div>
</div>

<div class="card">
<div class="stat" id="teacherCount">0</div>
<div class="label">Teachers</div>
</div>

</div>
</div>



<script type="module">

import { initializeApp }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";

import {
getAuth,
onAuthStateChanged,
signOut
}
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

import {
getFirestore,
doc,
getDoc,
collection,
getDocs
}
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";


// ðŸ”¥ USE SAME CONFIG AS LOGIN
const firebaseConfig = {
apiKey: "AIzaSyBIQog_gsN6U-2JXwpv8CBSMLuP92W6a7Q",
authDomain: "school-management-system-2f7de.firebaseapp.com",
projectId: "school-management-system-2f7de",
storageBucket: "school-management-system-2f7de.appspot.com",
messagingSenderId: "518987437886",
appId: "1:518987437886:web:3d451457c4a6457e007e6f"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);



/* ðŸ” AUTH GUARD */
onAuthStateChanged(auth, async (user)=>{

if(!user){
location.href="index.html";
return;
}

try{

const ref = doc(db,"users",user.uid);
const snap = await getDoc(ref);

if(!snap.exists()){
await signOut(auth);
location.href="index.html";
return;
}

const data = snap.data();

if(data.role !== "principal"){
await signOut(auth);
location.href="index.html";
return;
}

// âœ… Populate UI
document.getElementById("principalName")
.innerText = "Welcome, " + (data.fullName || "Principal");

document.getElementById("principalEmail")
.innerText = user.email;


// LOAD STATS
loadStats();

}catch(err){
console.error(err);
location.href="index.html";
}

});



/* ðŸ“Š LOAD COUNTS */
async function loadStats(){

const snapshot = await getDocs(collection(db,"users"));

let students=0;
let teachers=0;

snapshot.forEach(doc=>{

const role = doc.data().role;

if(role==="student") students++;
if(role==="teacher") teachers++;

});

document.getElementById("studentCount").innerText=students;
document.getElementById("teacherCount").innerText=teachers;

}



/* ðŸšª LOGOUT */
window.logout = async function(){

await signOut(auth);

location.href="index.html";

};

</script>

</body>
</html>

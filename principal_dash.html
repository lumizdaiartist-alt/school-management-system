<!DOCTYPE html><html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Principal Dashboard - BIS</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"><style>
:root {
    --chocolate: #3E2723;
    --cream: #FFF8E1;
    --gold: #FFB300;
    --white: #ffffff;
    --red: #d32f2f;
}

*{
margin:0;
padding:0;
box-sizing:border-box;
font-family:'Segoe UI', sans-serif;
}

body{
background:#fcfaf5;
padding-bottom:30px;
}

.navbar{
background:var(--chocolate);
padding:15px 20px;
display:flex;
justify-content:space-between;
align-items:center;
color:var(--cream);
position:sticky;
top:0;
z-index:1000;
}

.nav-right{
display:flex;
align-items:center;
gap:20px;
}

.bell-container{
position:relative;
cursor:pointer;
font-size:20px;
}

.bell-badge{
position:absolute;
top:-5px;
right:-5px;
background:var(--red);
color:white;
font-size:10px;
width:16px;
height:16px;
border-radius:50%;
display:none;
align-items:center;
justify-content:center;
border:2px solid var(--chocolate);
}

.settings-trigger{
font-size:20px;
cursor:pointer;
color:var(--gold);
}

.welcome-section{
background:var(--chocolate);
color:white;
padding:30px 20px 60px;
border-radius:0 0 30px 30px;
}

.stats-container{
display:flex;
gap:15px;
padding:0 20px;
margin-top:-40px;
}

.stat-card{
background:white;
flex:1;
padding:20px;
border-radius:15px;
text-align:center;
box-shadow:0 4px 15px rgba(0,0,0,0.1);
}

.stat-card i{
color:var(--gold);
font-size:20px;
margin-bottom:8px;
}

.section-title{
padding:25px 20px 10px;
color:var(--chocolate);
font-weight:bold;
display:flex;
align-items:center;
justify-content:space-between;
}

.reports-box{
margin:0 20px;
background:white;
border-radius:15px;
padding:15px;
box-shadow:0 2px 10px rgba(0,0,0,0.05);
max-height:180px;
overflow-y:auto;
}

.report-item{
display:flex;
align-items:center;
gap:12px;
padding:12px 0;
border-bottom:1px solid #eee;
}

.report-icon{
width:35px;
height:35px;
background:var(--cream);
color:var(--gold);
border-radius:8px;
display:flex;
align-items:center;
justify-content:center;
}

.main-menu{
padding:20px;
display:grid;
grid-template-columns:1fr 1fr;
gap:12px;
}

.menu-item{
background:white;
padding:15px;
border-radius:12px;
text-decoration:none;
display:flex;
flex-direction:column;
align-items:center;
gap:8px;
box-shadow:0 2px 8px rgba(0,0,0,0.05);
border:1px solid #efebe9;
transition:0.2s;
}

.menu-item:active{
transform:scale(0.95);
}

.menu-item i{
font-size:24px;
color:var(--chocolate);
}

.menu-item span{
color:var(--chocolate);
font-weight:600;
font-size:13px;
text-align:center;
}

.btn-reports{ border-left:4px solid var(--gold);} 
.btn-staff{ border-left:4px solid #4caf50;} 
.btn-timetable{ border-left:4px solid #2196F3;} 
.btn-announce{ border-left:4px solid #ff9800;} 

.notif-panel{
position:absolute;
top:60px;
right:20px;
width:260px;
background:white;
border-radius:12px;
box-shadow:0 10px 25px rgba(0,0,0,0.2);
display:none;
z-index:2000;
padding:15px;
}

.modal-overlay{
position:fixed;
top:0;
left:0;
width:100%;
height:100%;
background:rgba(0,0,0,0.7);
display:none;
justify-content:center;
align-items:center;
z-index:2000;
padding:20px;
}

.modal-content{
background:white;
width:100%;
max-width:350px;
border-radius:20px;
padding:25px;
position:relative;
}
</style></head><body><div class="navbar">
<div class="school-name">BIS Principal Portal</div><div class="nav-right">
<div class="bell-container" onclick="toggleNotifs()">
<i class="fas fa-bell"></i>
<div class="bell-badge" id="notifBadge">0</div>
</div><i class="fas fa-cog settings-trigger" onclick="toggleSettings(true)"></i>

</div>
</div><div class="notif-panel" id="notifPanel">
<h4 style="font-size:14px;margin-bottom:10px;border-bottom:1px solid #eee;padding-bottom:5px;">Notifications</h4>
<div id="notifList">
<p style="font-size:11px;color:#999;text-align:center;">No new updates</p>
</div>
</div><div class="welcome-section">
<h2 id="principalName">Welcome, Principal</h2>
<p id="principalID">Staff ID: Loading...</p>
</div><div class="stats-container">
<div class="stat-card">
<i class="fas fa-user-graduate"></i>
<h3 id="studentCount">0</h3>
<p style="font-size:11px;color:#888;">Students</p>
</div><div class="stat-card">
<i class="fas fa-chalkboard-teacher"></i>
<h3 id="teacherCount">0</h3>
<p style="font-size:11px;color:#888;">Teachers</p>
</div>
</div><div class="section-title">
<span>Recent Activity</span>
<i class="fas fa-history" style="color:var(--gold);"></i>
</div><div class="reports-box" id="reportsBox">
<p style="text-align:center;color:#999;font-size:12px;padding:20px;">No recent result uploads</p>
</div><div class="main-menu"><a href="New view_reports.html" class="menu-item btn-reports">
<i class="fas fa-file-signature" style="color:var(--gold);"></i>
<span>Academic Reports</span>
</a><a href="timetable.html" class="menu-item btn-timetable">
<i class="fas fa-calendar-alt" style="color:#2196F3;"></i>
<span>Master Timetable</span>
</a><a href="add_teacher.html" class="menu-item btn-staff">
<i class="fas fa-user-tie" style="color:#4caf50;"></i>
<span>Recruit Staff</span>
</a><a href="student_list.html" class="menu-item">
<i class="fas fa-list-ul"></i>
<span>Student List</span>
</a><a href="add_student.html" class="menu-item">
<i class="fas fa-user-plus"></i>
<span>Add Student</span>
</a><a href="manage_fees.html" class="menu-item">
<i class="fas fa-file-invoice-dollar"></i>
<span>Manage Fees</span>
</a><a href="staff_list.html" class="menu-item">
<i class="fas fa-users-cog"></i>
<span>Staff List</span>
</a><a href="#" onclick="openAnnouncementModal()" class="menu-item btn-announce">
<i class="fas fa-bullhorn" style="color:#ff9800;"></i>
<span>Post Announcement</span>
</a><a href="#" onclick="logout()" class="menu-item" style="background:#fff5f5;grid-column:span 2;">
<i class="fas fa-sign-out-alt" style="color:#d32f2f;"></i>
<span style="color:#d32f2f;">Logout</span>
</a></div><div class="modal-overlay" id="settingsModal">
<div class="modal-content">
<span onclick="toggleSettings(false)" style="position:absolute;top:15px;right:20px;cursor:pointer;">&times;</span><h3>Update Profile</h3><label style="font-size:12px;color:#888;">Full Name</label> <input type="text" id="editPrincipalName"
style="width:100%;padding:10px;margin:5px 0 15px;border:1px solid #ddd;border-radius:8px;">

<button onclick="updateSecurity()"
style="width:100%;padding:12px;background:var(--chocolate);color:white;border:none;border-radius:10px;font-weight:bold;"> Save Changes </button>

</div>
</div><div class="modal-overlay" id="announcementModal">
<div class="modal-content">
<span onclick="closeAnnouncementModal()" style="position:absolute;top:15px;right:20px;cursor:pointer;">&times;</span><h3>Post School Announcement</h3><textarea id="announcementText"
placeholder="Type announcement..."
style="width:100%;height:120px;padding:12px;margin-top:15px;border-radius:10px;border:1px solid #ddd;resize:none;"></textarea><button onclick="postAnnouncement()"
style="width:100%;padding:12px;margin-top:15px;background:var(--chocolate);color:white;border:none;border-radius:10px;font-weight:bold;"> Publish Announcement </button>

</div>
</div><script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {
    getAuth,
    onAuthStateChanged,
    signOut
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import {
    getFirestore,
    doc,
    getDoc,
    collection,
    addDoc,
    serverTimestamp,
    getDocs
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBIQog_gsN6U-2JXwpv8CBSMLuP92W6a7Q",
  authDomain: "school-management-system-2f7de.firebaseapp.com",
  projectId: "school-management-system-2f7de",
  storageBucket: "school-management-system-2f7de.appspot.com",
  messagingSenderId: "518987437886",
  appId: "1:518987437886:web:3d451457c4a6457e007e6f"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* ‚úÖ AUTH GUARD ‚Äî STOPS THE FLUCTUATION */
onAuthStateChanged(auth, async (user) => {
    if (!user) {
        window.location.href = "index.html";
        return;
    }

    const ref = doc(db, "users", user.uid);
    const snap = await getDoc(ref);

    if (!snap.exists() || snap.data().role !== "principal") {
        window.location.href = "index.html";
        return;
    }

    const data = snap.data();

    document.getElementById('principalName').innerText = "Welcome, " + (data.fullName || "Principal");
    document.getElementById('principalID').innerText = "Staff ID: " + (data.staffId || user.uid);
    document.getElementById('editPrincipalName').value = data.fullName || "";

    refreshStats();
});

/* üìä STATS */
async function refreshStats(){
    const snapshot = await getDocs(collection(db, "users"));
    let students = 0;
    let teachers = 0;

    snapshot.forEach(d => {
        const role = d.data().role;
        if(role === "student") students++;
        if(role === "teacher") teachers++;
    });

    document.getElementById("studentCount").innerText = students;
    document.getElementById("teacherCount").innerText = teachers;
}

/* üì£ ANNOUNCEMENT */
window.postAnnouncement = async function () {
    const text = document.getElementById('announcementText').value.trim();

    if (!text) {
        alert("Announcement cannot be empty.");
        return;
    }

    await addDoc(collection(db, "announcements"), {
        message: text,
        postedBy: "Principal",
        createdAt: serverTimestamp()
    });

    document.getElementById('announcementText').value = "";
    closeAnnouncementModal();
    alert("Announcement sent successfully!");
};

/* üîê LOGOUT */
window.logout = async function(){
    await signOut(auth);
    window.location.href = "index.html";
};

</script><script>
function toggleNotifs(){
    const panel=document.getElementById('notifPanel');
    panel.style.display = panel.style.display==='block' ? 'none':'block';
}

function toggleSettings(show){
    document.getElementById('settingsModal').style.display=show?'flex':'none';
}

function openAnnouncementModal(){
    document.getElementById('announcementModal').style.display='flex';
}

function closeAnnouncementModal(){
    document.getElementById('announcementModal').style.display='none';
}

function updateSecurity(){
    alert("Profile editing should be connected to Firestore. Tell me if you want that wired properly.");
}
</script></body>
  </html>

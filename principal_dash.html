<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Principal Dashboard - BIS</title>

<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>
/* KEEPING YOUR DESIGN â€” trimmed for stability */

:root{
--chocolate:#3E2723;
--gold:#FFB300;
}

body{
margin:0;
font-family:'Segoe UI',sans-serif;
background:#fcfaf5;
}

.navbar{
background:var(--chocolate);
color:white;
padding:15px;
display:flex;
justify-content:space-between;
align-items:center;
}

.logout-btn{
cursor:pointer;
color:var(--gold);
font-size:18px;
}

.welcome{
background:var(--chocolate);
color:white;
padding:30px;
border-radius:0 0 25px 25px;
}

.stats{
display:flex;
gap:15px;
padding:20px;
}

.card{
flex:1;
background:white;
padding:20px;
border-radius:12px;
text-align:center;
}
</style>
</head>

<body>

<div class="navbar">
<b>BIS Principal Portal</b>

<i id="logoutBtn"
class="fas fa-sign-out-alt logout-btn"
title="Logout"></i>
</div>

<div class="welcome">
<h2 id="principalName">Loading...</h2>
<p id="principalID"></p>
</div>

<div class="stats">

<div class="card">
<h3 id="studentCount">--</h3>
<p>Students</p>
</div>

<div class="card">
<h3 id="teacherCount">--</h3>
<p>Teachers</p>
</div>

</div>



<!-- ðŸ”¥ SINGLE FIREBASE ENGINE -->
<script type="module">

import { initializeApp }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";

import {
getAuth,
onAuthStateChanged,
signOut
}
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

import {
getFirestore,
doc,
getDoc,
collection,
getDocs,
addDoc,
serverTimestamp
}
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";


/* CONFIG */

const firebaseConfig = {
apiKey:"AIzaSyBIQog_gsN6U-2JXwpv8CBSMLuP92W6a7Q",
authDomain:"school-management-system-2f7de.firebaseapp.com",
projectId:"school-management-system-2f7de",
storageBucket:"school-management-system-2f7de.appspot.com",
messagingSenderId:"518987437886",
appId:"1:518987437886:web:3d451457c4a6457e007e6f"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);



/* ðŸ”¥ PROTECT DASHBOARD */

onAuthStateChanged(auth, async(user)=>{

if(!user){
window.location.replace("index.html");
return;
}

/* get profile */

const ref = doc(db,"users",user.uid);
const snap = await getDoc(ref);

if(!snap.exists()){
await signOut(auth);
window.location.replace("index.html");
return;
}

const data = snap.data();

/* ðŸ”¥ ROLE LOCK */

if((data.role || "").toLowerCase() !== "principal"){
alert("Unauthorized access.");
await signOut(auth);
window.location.replace("index.html");
return;
}


/* LOAD UI */

document.getElementById("principalName")
.innerText = "Welcome, " + (data.fullName || "Principal");

document.getElementById("principalID")
.innerText = "Staff ID: " + user.uid;


/* LOAD STATS */

loadStats();

});



/* STATS */

async function loadStats(){

const snap = await getDocs(collection(db,"users"));

let students=0;
let teachers=0;

snap.forEach(d=>{

const role = (d.data().role || "").toLowerCase();

if(role==="student") students++;
if(role==="teacher") teachers++;

});

document.getElementById("studentCount").innerText=students;
document.getElementById("teacherCount").innerText=teachers;

}



/* LOGOUT */

document.getElementById("logoutBtn")
.onclick = async()=>{

await signOut(auth);

window.location.replace("index.html");

};



/* ANNOUNCEMENT (kept your feature) */

window.postAnnouncement = async(text)=>{

await addDoc(collection(db,"announcements"),{
message:text,
postedBy:"Principal",
createdAt:serverTimestamp()
});

};

</script>

</body>
</html>

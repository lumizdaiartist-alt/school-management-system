<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Academic Reports - BIS</title>

<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>
:root{
--chocolate:#3E2723;
--gold:#FFB300;
--cream:#FFF8E1;
}

*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',sans-serif;}
body{background:#fcfaf5;padding:20px;}

.header{
display:flex;
gap:15px;
align-items:center;
margin-bottom:20px;
color:var(--chocolate);
}

.folder-grid{
display:grid;
grid-template-columns:1fr 1fr;
gap:15px;
}

.folder{
background:white;
padding:25px;
border-radius:15px;
text-align:center;
cursor:pointer;
box-shadow:0 4px 6px rgba(0,0,0,.05);
}

.folder i{
font-size:45px;
color:var(--gold);
}

.student-list{
display:none;
background:white;
border-radius:15px;
padding:5px;
}

.student-item{
display:flex;
justify-content:space-between;
padding:18px;
border-bottom:1px solid #eee;
cursor:pointer;
}

.modal-overlay{
position:fixed;
top:0;left:0;
width:100%;height:100%;
background:rgba(0,0,0,.85);
display:none;
justify-content:center;
align-items:center;
padding:15px;
}

.report-card{
background:white;
width:100%;
max-width:600px;
border-radius:20px;
overflow:hidden;
}

.report-header{
background:var(--chocolate);
color:white;
padding:20px;
text-align:center;
}

.report-body{
padding:20px;
}

table{
width:100%;
border-collapse:collapse;
font-size:12px;
}

th,td{
border:1px solid #ddd;
padding:8px;
text-align:center;
}

.print-footer{
display:flex;
gap:10px;
padding:15px;
}

.btn{
flex:1;
padding:14px;
border:none;
border-radius:10px;
font-weight:bold;
cursor:pointer;
}

.btn-print{
background:var(--gold);
}

.btn-close{
background:#eee;
}

</style>
</head>

<body>

<div class="header">
<a href="principal_dash.html">
<i class="fas fa-arrow-left"></i>
</a>
<h2>Reports Vault</h2>
</div>

<!-- TEACHERS -->
<div id="teacherArea" class="folder-grid"></div>

<!-- CLASSES -->
<div id="classArea" class="folder-grid" style="display:none;"></div>

<!-- STUDENTS -->
<div id="studentList" class="student-list"></div>


<!-- RESULT MODAL -->
<div class="modal-overlay" id="modal">

<div class="report-card">

<div class="report-header">
<h3>BENAIAH INTERNATIONAL SCHOOL</h3>
<h2>STUDENT ACADEMIC RECORD</h2>
</div>

<div class="report-body">

<p><b>Name:</b> <span id="rName"></span></p>
<p><b>Class:</b> <span id="rClass"></span></p>

<table>
<thead>
<tr>
<th>Subject</th>
<th>CA1</th>
<th>CA2</th>
<th>CA3</th>
<th>Exam</th>
<th>Total</th>
<th>Grade</th>
</tr>
</thead>

<tbody id="resultBody"></tbody>

</table>

</div>

<div class="print-footer">
<button class="btn btn-close" onclick="closeModal()">Close</button>
<button class="btn btn-print" onclick="window.print()">Print</button>
</div>

</div>
</div>



<script type="module">

import { initializeApp }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";

import {
getFirestore,
collection,
getDocs,
query,
where
}
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";


// ðŸ”¥ Firebase Config
const firebaseConfig = {
apiKey: "AIzaSyBIQog_gsN6U-2JXwpv8CBSMLuP92W6a7Q",
authDomain: "school-management-system-2f7de.firebaseapp.com",
projectId: "school-management-system-2f7de",
storageBucket: "school-management-system-2f7de.appspot.com",
messagingSenderId: "518987437886",
appId: "1:518987437886:web:3d451457c4a6457e007e6f"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);


// UI refs
const teacherArea = document.getElementById("teacherArea");
const classArea = document.getElementById("classArea");
const studentList = document.getElementById("studentList");


// LOAD TEACHERS
async function loadTeachers(){

teacherArea.innerHTML = "Loading teachers...";

const q = query(
collection(db,"users"),
where("role","==","teacher")
);

const snap = await getDocs(q);

let html="";

snap.forEach(doc=>{
const t = doc.data();

html+=`
<div class="folder" onclick="showClasses('${doc.id}','${t.fullName}')">
<i class="fas fa-chalkboard-teacher"></i>
<p>${t.fullName}</p>
</div>
`;
});

teacherArea.innerHTML = html;

}


// SHOW CLASSES
window.showClasses = function(teacherId, teacherName){

teacherArea.style.display="none";
classArea.style.display="grid";

const classes = ["JSS1","JSS2","JSS3","SSS1","SSS2","SSS3"];

classArea.innerHTML = classes.map(c=>`
<div class="folder" onclick="showStudents('${c}')">
<i class="fas fa-folder"></i>
<p>${c}</p>
</div>
`).join('');

}



// SHOW STUDENTS
window.showStudents = async function(cls){

classArea.style.display="none";
studentList.style.display="block";
studentList.innerHTML="Loading students...";

const q = query(
collection(db,"users"),
where("role","==","student"),
where("class","==",cls)
);

const snap = await getDocs(q);

if(snap.empty){
studentList.innerHTML="<p style='padding:20px'>No students</p>";
return;
}

let html="";

snap.forEach(doc=>{

const s = doc.data();

html+=`
<div class="student-item"
onclick="openResult('${doc.id}','${s.fullName}','${cls}')">
<span>${s.fullName}</span>
<i class="fas fa-chevron-right"></i>
</div>
`;
});

studentList.innerHTML = html;

}



// OPEN RESULT
window.openResult = async function(studentId, name, cls){

document.getElementById("modal").style.display="flex";
document.getElementById("rName").innerText = name;
document.getElementById("rClass").innerText = cls;

const resultBody = document.getElementById("resultBody");

resultBody.innerHTML="Loading...";

const q = query(
collection(db,"results"),
where("studentId","==",studentId)
);

const snap = await getDocs(q);

if(snap.empty){
resultBody.innerHTML="<tr><td colspan='7'>No results found</td></tr>";
return;
}

let rows="";

snap.forEach(doc=>{

const r = doc.data();

rows+=`
<tr>
<td>${r.subject}</td>
<td>${r.ca1}</td>
<td>${r.ca2}</td>
<td>${r.ca3}</td>
<td>${r.exam}</td>
<td>${r.total}</td>
<td>${r.grade}</td>
</tr>
`;

});

resultBody.innerHTML = rows;

}



window.closeModal = function(){
document.getElementById("modal").style.display="none";
}


loadTeachers();

</script>

</body>
</html>